# PDF标题提取与重命名工具

这是一个功能完善的PDF文件批量处理自动化程序，可以递归遍历指定目录下的所有PDF文件，智能提取标题信息并将文件重命名为其标题文本。

## 功能特性

### 1. 文件遍历与内容提取
- 支持递归遍历指定根目录下的所有子文件夹
- 识别并处理所有PDF文件，提取每个文件内容中的标题信息
- 实现多区域内容识别算法，对PDF文档的页眉、页脚、正文等不同区域进行智能分析
- 应用关键词匹配验证机制，提高标题提取的准确性
- 支持从元数据和文档内容两种方式提取标题信息

### 2. 文件重命名功能
- 使用提取到的标题对文件进行重命名，严格保留原始文件的.pdf扩展名
- 文件将直接以论文标题命名，不包含年份、作者等额外信息
- 设计了完善的重复标题处理策略，当检测到相同标题时自动添加序号（如"标题-1.pdf"、"标题-2.pdf"）
- 对无法提取标题的文件，提供双重命名方案：系统默认命名规则和用户自定义命名选项

### 3. 日志记录系统
- 生成详细的处理日志文件，包含以下信息：
  - 每个文件的处理状态（成功重命名、标题提取失败、文件跳过等）
  - 原始文件名和完整路径
  - 新文件名和完整路径
  - 精确的处理时间戳（精确到秒）
  - 错误详情（如适用）

### 4. 错误处理与容错机制
- 实现PDF文件完整性检查，能够识别并跳过损坏的PDF文件
- 对加密或受保护的PDF文件进行特殊处理，并在日志中明确标记
- 所有错误情况均在日志中详细记录错误类型和可能原因
- 程序支持优雅的异常捕获和处理，确保单一文件的错误不会影响整体处理

### 5. 数据汇总功能
- 将所有文件夹中的论文信息汇总到一个Excel表格中
- Excel表格包含以下字段：
  - 原始文件名
  - 新文件名
  - 文件所在文件夹路径
  - 提取到的标题
  - 文件名标题
  - 机构名称
  - 处理状态
  - 处理时间戳

### 6. 灵活的配置选项
- 支持通过命令行参数进行灵活配置
- 可自定义日志级别，便于调试
- 提供默认配置和用户自定义配置选项

## 安装说明

### 1. 安装Python
确保你的系统已安装Python 3.7或更高版本。可以从[Python官网](https://www.python.org/downloads/)下载安装。

### 2. 安装依赖
使用以下命令安装程序所需的依赖库：

```bash
pip install -r requirements.txt
```

依赖库包括：
- PyPDF2: 用于PDF元数据提取
- pdfplumber: 用于PDF内容提取
- pandas: 用于数据处理和Excel报告生成
- openpyxl: 用于Excel文件写入

## 使用方法

### 基本用法

最简单的使用方式是直接运行程序并指定要处理的文件夹：

```bash
python pdf_title_renamer.py [文件夹路径]
```

如果不提供文件夹路径，程序会提示你输入。

### 高级选项

程序支持多种命令行参数来自定义处理行为：

```bash
python pdf_title_renamer.py [文件夹路径] [选项]
```

可用选项：

- `-r`, `--recursive`: 递归处理所有子文件夹
- `-n`, `--custom-name`: 无法识别标题时使用的自定义命名前缀
- `--no-excel`: 不生成Excel汇总报告
- `--log-level`: 设置日志级别（可选值：DEBUG, INFO, WARNING, ERROR，默认：INFO）

### 使用示例

1. 基本使用（当前文件夹）：
   ```bash
   python pdf_title_renamer.py
   ```

2. 指定文件夹并递归处理：
   ```bash
   python pdf_title_renamer.py D:\pdfs -r
   ```

3. 使用自定义未知文件命名前缀：
   ```bash
   python pdf_title_renamer.py D:\pdfs --custom-name 未命名论文
   ```

4. 启用调试日志：
   ```bash
   python pdf_title_renamer.py D:\pdfs --log-level DEBUG
   ```

5. 禁用Excel报告生成：
   ```bash
   python pdf_title_renamer.py D:\pdfs --no-excel
   ```

## 输出说明

### 日志文件
处理日志将保存在程序所在目录下的`logs`文件夹中，文件名格式为`pdf_renamer_YYYYMMDD_HHMMSS.log`。

### Excel报告
如果启用了Excel报告功能，报告文件将保存在`logs`文件夹中，文件名格式为`pdf_processing_report_YYYYMMDD_HHMMSS.xlsx`。

## 注意事项

1. 程序会自动跳过隐藏文件和系统文件（如Thumbs.db、desktop.ini等）。
2. 对于加密的PDF文件，程序会尝试使用空密码解密，如解密失败则会标记为加密文件。
3. 程序会确保文件名中不包含非法字符，以避免操作系统错误。
4. 处理大量文件时，可能需要较长时间，请耐心等待。

## 常见问题

### 问题：程序无法识别PDF标题

解决方案：
- 确保PDF文档格式标准，标题明显且位于文档首页
- 尝试使用更高的日志级别（DEBUG）查看详细处理过程
- 某些扫描版PDF可能无法提取文本信息，程序会使用默认命名

### 问题：程序无法处理某些PDF文件

解决方案：
- 检查文件是否加密，对于加密文件需要先解密
- 检查文件是否损坏，可以尝试用PDF阅读器打开验证

### 问题：生成的Excel报告无法打开

解决方案：
- 确保已正确安装openpyxl库
- 检查日志文件中的错误信息以获取详细原因

## 许可证

本项目仅供个人学习和使用，未经授权不得用于商业用途。

## 更新日志

### v1.0 (初始版本)
- 实现PDF标题提取和重命名功能
- 支持递归处理文件夹
- 实现Excel报告生成
- 添加完整的错误处理机制
- 支持命令行参数配置